<!doctype html>
<!--Random 'R' stuff written by David Nahmias-->
<html>
   <head>
    	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>
    	<script src="jquery.overlaps.js"></script>
		<style type="text/css">
			.hidden{visibility:hidden;}
		</style>
<script type = "text/JavaScript">
    	var randomPlacement = function(){
    		randNum1 = Math.floor(Math.random()*winHeight);
    		randNum2 = Math.floor(Math.random()*winWidth);
			ySector = Math.floor(gridSize*(10+randNum1)/winHeight);
	   		xSector = Math.floor(gridSize*(10+randNum2)/winWidth);
	   	};
    	
    	
    	var newScreen = function(t){
    		winWidth = $("#letters").width()-40;
			winHeight = $("#letters").height()-40;
			gridSize = 20;
			
			var u = 0;
			for (n=0; n<distractors.length;n++){					
				for (i=0;i < Math.floor(trialOrder[t][0]*distractors[n][1]);i++){
					randomPlacement();
    				$("#letters").append(	"<div id='trial_" + t + "_letter_div_" + u +"' class=\
						    				'letters trial_" + t + "' style= 'width:12px; color:none'>"
					    					+ distractors[n][0] + "</div>"); //adds letter
    				$("#trial_" + t + "_letter_div_"+ u).offset({ top: 10+randNum1, left: 10+randNum2}); //offsets letter to random position
					while($("#trial_" + t + "_letter_div_"+ u).overlaps($(".trial_" + t +".sector" + xSector + "_" + ySector))){
  						randomPlacement();
						$("#trial_" + t +"_letter_div_"+ u).offset({ top: 10+randNum1, left: 10+randNum2});
						
					} 
					$("#trial_" + t + "_letter_div_"+ u).addClass("placed");
					
    				for(k=0;k<=2;k++){
    					for(j=0;j<=2;j++){
    						$("#trial_" + t + "_letter_div_"+ u).addClass("sector" + (xSector+k-1) + "_" + (ySector+j-1));
    					}
    				}
    				u=u+1;
    			}		
    		}
			var rand = Math.random();
    		console.log(trialOrder[t]);
       			for (j=0;j<1;j++){
					randomPlacement();
					if (trialOrder[t][1]) {
						$("#letters").append(	"<div id='trial_" +t+"_targ_letter_div_" + j +"' class='\
												letters trial_" + t + "' style='width:12px; color:\
												none'>"+ target + "</div>");
					}
					else{
						$("#letters").append(	"<div id='trial_" +t+"_targ_letter_div_" + j +"' class='\
												letters trial_" + t + "' style='width:12px; color:\
												none'>"+ distractors[Math.floor(Math.random()*distractors.length)][0] + "</div>");
					}
	   				$("#trial_" +t+"_targ_letter_div_"+ j).offset({ top: 10+randNum1, left: 10+randNum2});
				    			
    				while($("#trial_" + t + "_targ_letter_div_"+j).overlaps($('.placed'))){
    					randomPlacement()
     					$("#trial_"+t+"_targ_letter_div_"+ j).offset({ top: 10+randNum1, left: 10+randNum2});
    				} 
    			}
	   	};
    	
    	$(document).ready(function(){
    		t=0;
    		$('body').append('<div id="letters" class="letters" style="width:2000px; height:2000px; background-color:none"></div>');
        	$('#letters').css({'height':(($(window).height())-50)+'px'});
        	$(window).resize(function(){
		        $('#letters').css({'height':(($(window).height())-50)+'px'});
    	    });
	    	$('#letters').css({'width':(($(window).width())-50)+'px'});

       		$(window).resize(function(){
       			$('#letters').css({'width':(($(window).width())-50)+'px'});
        	});        	
    	});
    	
//DEFINE YOUR PARAMETERS FOR THE EXPERIMENT
		numberDistractors = [	[4,20], //formatted as [number of distractors, number of trials]
     							[8,20],
     							[12,20],
     							[16,20],
     							[20,20],
     							[24,20],
     							[28,20]	
     							];
		distractors = [ ["O", .33], //formatted as [distractor, percentage of distractors]
						["R", .33],
						["Y", .33]	
						];
								
		target = "Q";
		percentagePresent = .5;
		
//END DEFINE PARAMETERS FOR EXPERIMENT

		trialOrder = [];
		for (i=0; i<numberDistractors.length;i++){
			for (k=0; k<numberDistractors[i][1]; k++){
				for (n=0; n < Math.ceil(numberDistractors[i][1]/2);n++){
					trialOrder[trialOrder.length] = [numberDistractors[i][0],true];
					//console.log(trialOrder.length);
				}
				for (n=0; n<Math.ceil(numberDistractors[i][1]/2);n++){
					trialOrder[trialOrder.length] = [numberDistractors[i][0],false];
					//console.log(trialOrder.length);
				}

			}
		}

		var j, x, i = trialOrder.length;  //following while loop is variation on Fisher-Yates shuffle algorithm.  Shuffles trialOrder randomly.  
		while (i) { // same as while(i != 0)
		   j = parseInt(Math.random() * i);
		   x = trialOrder[--i];
		   trialOrder[i] = trialOrder[j];
		   trialOrder[j] = x;
		}
    	
    	select = true;
		trialResults = [];
		$(document).keydown(function(e) {
    		var code = (e.keyCode ? e.keyCode : e.which);
    		if (code == 32 && t<trialOrder.length && select == true ){
				//console.log(t);
				var t1= new Date();
				newScreen(t); 
				var t2= new Date();
				var keypress= t1.getTime();
				start=t2.getTime();
				var elapsed= (start-keypress)/1000;
				console.log(elapsed);
				select = false;
			}
    		if (code == 70 && t<trialOrder.length && select == false){
				var t3 = new Date();
	    		end=t3.getTime();
				console.log(t);
				trialResults[t]= [t,trialOrder[t][0],trialOrder[t][1], true, (end-start)/1000];
				$("#letters").text("");
				console.log(trialResults[t]);
				select = true;
				t=t+1;
			}
			else if (code == 74 && t<trialOrder.length && select == false) {
				var t3 = new Date();
	    		end=t3.getTime();
				console.log(t);
				trialResults[t] = [t,trialOrder[t][0],trialOrder[t][1], false, (end-start)/1000];
				$("#letters").text("");
				console.log(trialResults[t]);
				select = true;
				t=t+1;
			}
     	});
</script>
   </head>
   
   <body id='body'>
   </body>
</html>