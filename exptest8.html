<!doctype html>
<!--Random 'R' stuff written by David Nahmias-->
<html>
   <head>
    	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>
    	<script src="jquery.overlaps.js"></script>
		<style type="text/css">
			.hidden{visibility:hidden;}
		</style>
<script type = "text/JavaScript">
    	var newScreen = function(t){
    		var t1= new Date();
			$("#letters").text("");
    		winWidth = $("#letters").width()-40;
			winHeight = $("#letters").height()-40;
			//console.log(winHeight);
			//console.log(winWidth);
			var gridSize = 20;
			var numberDistractors = 500;
			var distractors = [ ["R", .33],
								["O", .33],
								["Y", .33]]; 
								
			var u = 0;
			for (n=0; n<distractors.length;n++){					
				for (i=0;i < Math.floor(numberDistractors*distractors[n][1]);i++){
    	    		var randNum3 = Math.floor(Math.random()*winHeight);
    				var randNum4 = Math.floor(Math.random()*winWidth);
					var xSector = Math.floor(gridSize*(10+randNum4)/winWidth);
					var ySector = Math.floor(gridSize*(10+randNum3)/winHeight);
    				$("#letters").append(	"<div id='trial_" + t + "_letter_div_" + u +"' class=\
						    				'letters trial_" + t + "' style= 'width:12px; color:none'>"
					    					+ distractors[n][0] + "</div>"); //adds letter
    				$("#trial_" + t + "_letter_div_"+ u).offset({ top: 10+randNum3, left: 10+randNum4}); //offsets letter to random position
					//console.log("sector" + xSector + "_" + ySector);
					//console.log($("#trial_" + t + "_letter_div_"+i).overlaps($(".trial_" + t +".sector" + xSector + "_" + ySector)));
					while($("#trial_" + t + "_letter_div_"+ u).overlaps($(".trial_" + t +".sector" + xSector + "_" + ySector))){
  						var randNum = Math.floor(Math.random()*winHeight);
						var randNum2 = Math.floor(Math.random()*winWidth);
						xSector = Math.floor(gridSize*(10+randNum2)/winWidth);
						ySector = Math.floor(gridSize*(10+randNum)/winHeight);
						//console.log("sector" + xSector + "_" + ySector);
						//console.log($("#trial_" + t + "_letter_div_"+i).overlaps($(".trial_" + t +".sector" + xSector + "_" + ySector)));
						$("#trial_" + t +"_letter_div_"+ u).offset({ top: 10+randNum, left: 10+randNum2});
						
					} 
					$("#trial_" + t + "_letter_div_"+ u).addClass("placed");
					console.log('trial '+t + " letter " + u);
					console.log($("#trial_" + t +"_letter_div_"+ u).css('top'));
					
    				for(k=0;k<=2;k++){
    					for(j=0;j<=2;j++){
    						console.log('add sector sector' + (xSector+k-1) + "_" + (ySector+j-1));
    						$("#trial_" + t + "_letter_div_"+ u).addClass("sector" + (xSector+k-1) + "_" + (ySector+j-1));
    					}
    				}
    				u=u+1;
    			}		
    		}
    		for (j=0;j<1;j++){
    		    var randNum7 = Math.floor(Math.random()*winHeight);
     			var randNum8 = Math.floor(Math.random()*winWidth);
    			$("#letters").append("<div id='trial_" +t+"_targ_letter_div_" + j +"' class='letters trial_" + t + "' style='width:12px; color:none'>Q</div>");
    			$("#trial_" +t+"_targ_letter_div_"+ j).offset({ top: 10+randNum7, left: 10+randNum8});
				var xSector = Math.floor(gridSize*(10+randNum6)/winWidth);
				var ySector = Math.floor(gridSize*(10+randNum5)/winHeight);
				    			
    			while($("#trial_" + t + "_targ_letter_div_"+j).overlaps($('.placed'))){
    				var randNum5 = Math.floor(Math.random()*winHeight);
     				var randNum6 = Math.floor(Math.random()*winWidth);
     				xSector = Math.floor(gridSize*(10+randNum6)/winWidth);
					ySector = Math.floor(gridSize*(10+randNum5)/winHeight);
     				$("#trial_"+t+"_targ_letter_div_"+ j).offset({ top: 10+randNum5, left: 10+randNum6});
    			} 
    		}
			var t2= new Date();
			var start= t1.getTime();
			var end=t2.getTime();
			var elapsed= (end-start)/1000
			console.log(elapsed)
			console.log('ready');

    	};
    	
    	$(document).ready(function(){
    		$('body').append('<div id="letters" class="letters" style="width:2000px; height:2000px; background-color:none"></div>');
        	$('#letters').css({'height':(($(window).height())-50)+'px'});
        	$(window).resize(function(){
		        $('#letters').css({'height':(($(window).height())-50)+'px'});
    	    });
	    	$('#letters').css({'width':(($(window).width())-50)+'px'});

       		$(window).resize(function(){
       			$('#letters').css({'width':(($(window).width())-50)+'px'});
        	});        	
    	});
    	

    	var t = 0;
    	$(document).keydown(function(e) {
    		var code = (e.keyCode ? e.keyCode : e.which);
    		if (code == 32){
				newScreen(t); //changes page styles before function finishes running
				t=t+1;
     		};
   		});
</script>
   </head>
   
   <body id='body'>
   </body>
</html>